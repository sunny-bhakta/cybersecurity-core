# 13. Cloud Pentesting

## Overview

Cloud penetration testing involves assessing the security of cloud-based infrastructure, services, and applications. This includes testing cloud platforms like AWS, Azure, and GCP.

## Cloud Platforms

### AWS (Amazon Web Services)
- EC2, S3, Lambda, RDS
- IAM, VPC, CloudFormation
- ECS/EKS, API Gateway, CloudFront

### Azure (Microsoft)
- Virtual Machines, Blob Storage
- Azure Functions, Azure SQL
- Azure AD, Virtual Network
- Azure Container Instances

### GCP (Google Cloud Platform)
- Compute Engine, Cloud Storage
- Cloud Functions, Cloud SQL
- Cloud Identity, VPC
- Google Kubernetes Engine (GKE)

## Cloud Security Testing Areas

### Identity and Access Management (IAM)

#### IAM Policy Review
- Overly permissive policies
- Wildcard permissions
- Principle of least privilege violations
- Policy misconfigurations

#### IAM Enumeration
- User enumeration
- Role enumeration
- Policy enumeration
- Permission boundaries

#### IAM Attack Vectors
- Privilege escalation
- Role assumption attacks
- Cross-account access
- Service account abuse
- Temporary credential abuse

### Cloud Storage Security

#### S3 Bucket Security (AWS)
- Public bucket enumeration
- Bucket policy misconfigurations
- Access control list (ACL) issues
- Pre-signed URL vulnerabilities
- Versioning and lifecycle policies

#### Azure Blob Storage
- Public container access
- Shared Access Signature (SAS) tokens
- Storage account key exposure

#### GCP Cloud Storage
- Public bucket access
- IAM permissions on buckets
- Signed URLs

### Compute Security

#### Virtual Machine Security
- Instance metadata service (IMDS) abuse
- User data scripts
- SSH key exposure
- Security group misconfigurations
- Network ACL issues

#### Container Security
- Container image vulnerabilities
- Container runtime security
- Orchestration platform security
- Container escape techniques

#### Serverless Security
- Function permissions
- Environment variable exposure
- Event injection
- Cold start attacks
- Resource exhaustion

### Cloud Network Security

#### Virtual Private Cloud (VPC)
- Network segmentation
- Security group rules
- Network ACLs
- Route table misconfigurations
- Peering connections

#### Load Balancer Security
- SSL/TLS configuration
- Backend security
- WAF bypass techniques

### Cloud API Security

#### API Gateway Security
- Authentication/authorization
- Rate limiting
- Input validation
- API key management

#### REST API Security
- Endpoint enumeration
- Authentication bypass
- Authorization flaws
- Data exposure

### Secrets Management

#### Secrets Storage
- AWS Secrets Manager
- Azure Key Vault
- GCP Secret Manager
- HashiCorp Vault

#### Secrets Exposure
- Hardcoded secrets
- Environment variable exposure
- Configuration file exposure
- Log file exposure
- Source code repositories

## Cloud-Specific Vulnerabilities

### SSRF (Server-Side Request Forgery)
- Cloud metadata service access
- Internal service enumeration

### Subdomain Takeover
- CNAME records pointing to deleted resources
- Cloud service misconfigurations

### Supply Chain Attacks
- Third-party integrations
- Marketplace applications
- CI/CD pipeline security

## Cloud Security Tools

### AWS Security Tools
- **Prowler**: AWS security assessment tool
- **CloudSploit**: AWS security scanning
- **S3Scanner**: S3 bucket finder
- **AWS CLI**: Command-line interface
- **CloudMapper**: AWS environment visualization

### Multi-Cloud Tools
- **Scout Suite**: Multi-cloud security auditing
- **CloudSploit**: Multi-cloud security scanning
- **Terrascan**: Infrastructure as Code scanning
- **Checkov**: Infrastructure as Code security

### Secret Scanning
- **TruffleHog**: Secret scanning
- **GitLeaks**: Secret detection in Git
- **detect-secrets**: Secret detection

## Code Examples

### Python Examples
See the `examples/` directory for:
- `s3_bucket_scanner.py` - Scans for publicly accessible S3 buckets

### Node.js Examples
See the `examples/nodejs/` directory for:
- `s3_bucket_scanner.js` - S3 bucket scanner (Node.js)

### Usage
```bash
# Python
python examples/s3_bucket_scanner.py my-bucket test-bucket

# Node.js
node examples/nodejs/s3_bucket_scanner.js my-bucket test-bucket
```

## Best Practices

1. Understand shared responsibility model
2. Test IAM policies thoroughly
3. Check for public resources
4. Review cloud configurations
5. Test serverless functions
6. Verify encryption in transit and at rest
7. Check for exposed secrets
8. Test network segmentation
9. Review logging and monitoring
10. Understand cloud-specific attack vectors

## Legal Considerations

- Obtain proper authorization
- Understand cloud provider terms of service
- Respect rate limits
- Follow responsible disclosure
- Comply with data protection regulations

---

**Previous**: [12. Mobile Security](../12-mobile-security)  
**Next**: [14. Container & DevOps Security](../14-container-devops-security)

