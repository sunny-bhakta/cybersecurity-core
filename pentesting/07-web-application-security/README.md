# 07. Web Application Security

## Overview

Web application security testing focuses on identifying vulnerabilities in web applications, APIs, and web services. This is one of the most common types of penetration testing.

## OWASP Top 10 (2021)

1. **A01:2021 – Broken Access Control**
   - Unauthorized access to resources
   - IDOR (Insecure Direct Object References)
   - Missing function-level access control

2. **A02:2021 – Cryptographic Failures**
   - Weak encryption
   - Insecure data transmission
   - Poor key management

3. **A03:2021 – Injection**
   - SQL Injection
   - Command Injection
   - LDAP Injection
   - NoSQL Injection

4. **A04:2021 – Insecure Design**
   - Design flaws
   - Missing security controls
   - Insecure architecture

5. **A05:2021 – Security Misconfiguration**
   - Default credentials
   - Unnecessary features enabled
   - Missing security headers

6. **A06:2021 – Vulnerable and Outdated Components**
   - Known vulnerabilities in dependencies
   - Unpatched software
   - Outdated libraries

7. **A07:2021 – Identification and Authentication Failures**
   - Weak authentication
   - Session management issues
   - Credential stuffing

8. **A08:2021 – Software and Data Integrity Failures**
   - Insecure CI/CD pipelines
   - Unsigned updates
   - Dependency confusion

9. **A09:2021 – Security Logging and Monitoring Failures**
   - Insufficient logging
   - Missing monitoring
   - Poor incident response

10. **A10:2021 – Server-Side Request Forgery (SSRF)**
    - Internal service access
    - Cloud metadata access
    - Port scanning via application

## Web Application Vulnerabilities

### Cross-Site Scripting (XSS)

#### Reflected XSS
- XSS payload reflected in response
- Typically in search, error messages
- Requires user interaction

#### Stored XSS
- XSS payload stored in database
- Executed when page is viewed
- More dangerous than reflected

#### DOM-based XSS
- XSS in client-side JavaScript
- No server interaction required
- Harder to detect

#### Blind XSS
- XSS payload stored but execution not immediately visible
- Detected through monitoring/logging

### SQL Injection (SQLi)

#### Union-based SQLi
- Uses UNION operator
- Extracts data directly
- Requires column count matching

#### Error-based SQLi
- Exploits error messages
- Reveals database structure
- Information disclosure

#### Blind SQLi (Boolean-based)
- True/false responses
- Time-consuming
- Requires many requests

#### Blind SQLi (Time-based)
- Uses time delays
- Confirms injection point
- Very slow

#### Second-order SQLi
- Stored payload
- Executed later
- Harder to detect

### Broken Object Level Authorization (BOLA/IDOR)

- **Insecure Direct Object References (IDOR)**
  - Direct access to objects
  - Predictable identifiers
  - Missing authorization checks

- **Horizontal Privilege Escalation**
  - Access to other users' data
  - Same privilege level
  - User enumeration

- **Vertical Privilege Escalation**
  - Access to admin functions
  - Higher privilege level
  - Function-level access control bypass

### Business Logic Vulnerabilities (BLVs)

- **Workflow Bypass**
  - Skipping steps in process
  - Direct access to endpoints
  - Missing validation

- **Price Manipulation**
  - Modifying prices client-side
  - Negative values
  - Discount abuse

- **Quantity Manipulation**
  - Changing quantities
  - Integer overflow
  - Negative quantities

- **Payment Bypass**
  - Skipping payment
  - Reusing payment tokens
  - Race conditions

### Race Conditions

- **Time-of-Check to Time-of-Use (TOCTOU)**
  - State changes between check and use
  - Concurrent requests
  - Double spending

- **Testing Techniques**
  - Concurrent request sending
  - Burp Suite Turbo Intruder
  - Custom race condition scripts

### HTTP Request Smuggling

- **CL.TE (Content-Length: Transfer-Encoding)**
  - Desync between frontend and backend
  - Request smuggling
  - Cache poisoning

- **TE.CL (Transfer-Encoding: Content-Length)**
  - Reverse of CL.TE
  - Similar desync issues

- **TE.TE (Transfer-Encoding: Transfer-Encoding)**
  - Conflicting headers
  - Parsing differences

### Mass Assignment

- **Object Property Injection**
  - Adding unexpected parameters
  - Framework vulnerabilities
  - Over-posting

- **Testing Techniques**
  - Adding admin fields
  - Testing internal properties
  - Framework-specific testing

### Other Common Vulnerabilities

- **Cross-Site Request Forgery (CSRF)**
- **File Upload Vulnerabilities**
- **Local File Inclusion (LFI)**
- **Remote File Inclusion (RFI)**
- **Server-Side Template Injection (SSTI)**
- **XML External Entity (XXE) Injection**
- **JWT Vulnerabilities**
- **OAuth/OpenID Connect Vulnerabilities**

## Testing Methodology

1. **Reconnaissance**
   - Technology stack identification
   - Directory and file enumeration
   - Parameter discovery

2. **Vulnerability Identification**
   - Automated scanning
   - Manual testing
   - Code review (if available)

3. **Exploitation**
   - Proof of concept
   - Impact assessment
   - Data extraction

4. **Post-Exploitation**
   - Privilege escalation
   - Lateral movement
   - Persistence

## Tools

- **Burp Suite**: Web application security testing
- **OWASP ZAP**: Web application scanner
- **sqlmap**: SQL injection tool
- **XSStrike**: XSS detection tool
- **Nikto**: Web server scanner
- **Wfuzz**: Web application fuzzer
- **Gobuster**: Directory/file brute-forcing

## Code Examples

### Python Examples
See the `examples/` directory for:
- `sql_injection_tester.py` - Tests for various SQL injection vulnerabilities
- `idor_tester.py` - Tests for IDOR/BOLA vulnerabilities

### Node.js Examples
See the `examples/nodejs/` directory for:
- `sql_injection_tester.js` - SQL injection testing (Node.js)
- `idor_tester.js` - IDOR/BOLA testing (Node.js)

### Usage
```bash
# Python
python examples/sql_injection_tester.py http://example.com/page.php id user
python examples/idor_tester.js http://example.com/api/users

# Node.js
node examples/nodejs/sql_injection_tester.js http://example.com/page.php id user
node examples/nodejs/idor_tester.js http://example.com/api/users
```

## Best Practices

1. Test all user inputs
2. Verify authorization on every request
3. Test business logic thoroughly
4. Use multiple testing techniques
5. Document all findings
6. Test both authenticated and unauthenticated states
7. Verify server-side validation
8. Test error handling

---

**Previous**: [06. Post-Exploitation](../06-post-exploitation)  
**Next**: [08. Network & Infrastructure Pentesting](../08-network-infrastructure-pentesting)

