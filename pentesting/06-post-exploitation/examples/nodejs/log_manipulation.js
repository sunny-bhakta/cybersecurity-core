#!/usr/bin/env node
/**
 * Log Manipulation Tool
 * Demonstrates log manipulation techniques (for educational purposes).
 */

const fs = require('fs');
const os = require('os');

class LogManipulation {
    constructor() {
        this.manipulatedLogs = [];
    }

    clearLogs(logFile) {
        console.log(`[*] Clearing logs: ${logFile}...`);
        
        try {
            if (fs.existsSync(logFile)) {
                fs.writeFileSync(logFile, '', 'utf8');
                console.log(`[+] Logs cleared: ${logFile}`);
                return true;
            }
        } catch (err) {
            console.log(`[-] Error: ${err.message}`);
        }
        
        return false;
    }

    removeEntries(logFile, pattern) {
        console.log(`[*] Removing entries matching pattern: ${pattern}...`);
        
        try {
            if (fs.existsSync(logFile)) {
                const content = fs.readFileSync(logFile, 'utf8');
                const lines = content.split('\n');
                const filteredLines = lines.filter(line => !line.includes(pattern));
                
                fs.writeFileSync(logFile, filteredLines.join('\n'), 'utf8');
                console.log(`[+] Entries removed from: ${logFile}`);
                return true;
            }
        } catch (err) {
            console.log(`[-] Error: ${err.message}`);
        }
        
        return false;
    }

    modifyTimestamps(logFile) {
        console.log(`[*] Modifying timestamps: ${logFile}...`);
        
        try {
            const now = Date.now() / 1000;
            fs.utimesSync(logFile, now, now);
            console.log(`[+] Timestamps modified: ${logFile}`);
            return true;
        } catch (err) {
            console.log(`[-] Error: ${err.message}`);
        }
        
        return false;
    }

    generateReport() {
        let report = `# Log Manipulation Report\n\n`;
        
        report += `⚠️ **WARNING**: This tool is for educational purposes only!\n\n`;
        
        report += `## Log Manipulation Techniques\n\n`;
        
        const techniques = [
            '1. **Log Clearing**: Delete log file contents',
            '2. **Entry Removal**: Remove specific log entries',
            '3. **Timestamp Modification**: Alter file timestamps',
            '4. **Log Injection**: Inject false entries',
            '5. **Log Rotation**: Exploit log rotation mechanisms'
        ];
        
        techniques.forEach(technique => {
            report += `${technique}\n`;
        });
        report += `\n`;
        
        report += `## Detection Methods\n\n`;
        report += `1. **Log Integrity Monitoring**: Monitor for log modifications\n`;
        report += `2. **Centralized Logging**: Send logs to remote server\n`;
        report += `3. **Write-Once Storage**: Use append-only logs\n`;
        report += `4. **File Integrity Monitoring**: Monitor file changes\n`;
        report += `5. **Audit Logging**: Log access to log files\n\n`;
        
        report += `## Prevention\n\n`;
        report += `1. Use centralized logging\n`;
        report += `2. Implement log integrity checks\n`;
        report += `3. Restrict log file access\n`;
        report += `4. Use append-only log storage\n`;
        report += `5. Monitor for log anomalies\n\n`;
        
        report += `## Legal and Ethical Considerations\n\n`;
        report += `⚠️ **WARNING**: Log manipulation should only be performed:\n`;
        report += `- On systems you own\n`;
        report += `- With explicit written authorization\n`;
        report += `- In controlled testing environments\n`;
        report += `- Following responsible disclosure practices\n\n`;
        
        return report;
    }
}

function main() {
    console.log('Log Manipulation Tool');
    console.log('='.repeat(50));
    console.log('⚠️ WARNING: This tool is for authorized security testing only!');
    console.log('⚠️ Only use on systems you own or have permission to test!\n');
    
    const tool = new LogManipulation();
    const report = tool.generateReport();
    
    const filename = 'log_manipulation_report.md';
    fs.writeFileSync(filename, report, 'utf8');
    
    console.log(`[+] Log manipulation tool structure created`);
    console.log(`[+] Report saved to ${filename}`);
}

if (require.main === module) {
    main();
}

module.exports = LogManipulation;

