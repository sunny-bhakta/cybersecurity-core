#!/usr/bin/env node
/**
 * Anti-Forensics Tool
 * Demonstrates anti-forensics techniques (for educational purposes).
 */

const fs = require('fs');
const crypto = require('crypto');

class AntiForensics {
    constructor() {
        this.techniques = [];
    }

    secureDelete(filePath, passes = 3) {
        console.log(`[*] Securely deleting: ${filePath}...`);
        
        try {
            if (fs.existsSync(filePath)) {
                const stats = fs.statSync(filePath);
                const fileSize = stats.size;
                
                // Overwrite file multiple times
                for (let i = 0; i < passes; i++) {
                    const randomData = crypto.randomBytes(fileSize);
                    fs.writeFileSync(filePath, randomData);
                }
                
                // Truncate and delete
                fs.truncateSync(filePath, 0);
                fs.unlinkSync(filePath);
                
                console.log(`[+] File securely deleted: ${filePath}`);
                return true;
            }
        } catch (err) {
            console.log(`[-] Error: ${err.message}`);
        }
        
        return false;
    }

    clearMetadata(filePath) {
        console.log(`[*] Clearing metadata: ${filePath}...`);
        
        try {
            const now = Date.now() / 1000;
            fs.utimesSync(filePath, now, now);
            console.log(`[+] Metadata cleared: ${filePath}`);
            return true;
        } catch (err) {
            console.log(`[-] Error: ${err.message}`);
        }
        
        return false;
    }

    clearHistory() {
        console.log('[*] Clearing command history...');
        
        const historyFiles = [
            `${os.homedir()}/.bash_history`,
            `${os.homedir()}/.zsh_history`,
            `${os.homedir()}/.history`
        ];
        
        let cleared = false;
        for (const histFile of historyFiles) {
            if (fs.existsSync(histFile)) {
                try {
                    fs.writeFileSync(histFile, '', 'utf8');
                    cleared = true;
                } catch (err) {
                    // Ignore errors
                }
            }
        }
        
        if (cleared) {
            console.log('[+] Command history cleared');
        }
        
        return cleared;
    }

    generateReport() {
        let report = `# Anti-Forensics Report\n\n`;
        
        report += `⚠️ **WARNING**: This tool is for educational purposes only!\n\n`;
        
        report += `## Anti-Forensics Techniques\n\n`;
        
        const techniques = [
            '1. **Secure Deletion**: Overwrite files before deletion',
            '2. **Metadata Clearing**: Remove file metadata',
            '3. **History Clearing**: Clear command history',
            '4. **File Timestamp Manipulation**: Alter file times',
            '5. **Data Hiding**: Hide data in alternate data streams',
            '6. **Encryption**: Encrypt sensitive data'
        ];
        
        techniques.forEach(technique => {
            report += `${technique}\n`;
        });
        report += `\n`;
        
        report += `## Detection Methods\n\n`;
        report += `1. **File Carving**: Recover deleted files\n`;
        report += `2. **Metadata Analysis**: Analyze file metadata\n`;
        report += `3. **Timeline Analysis**: Analyze file timestamps\n`;
        report += `4. **Memory Analysis**: Analyze RAM for artifacts\n`;
        report += `5. **Network Analysis**: Analyze network traffic\n\n`;
        
        report += `## Prevention\n\n`;
        report += `1. Use write-blockers for forensics\n`;
        report += `2. Create forensic images immediately\n`;
        report += `3. Monitor for anti-forensics activity\n`;
        report += `4. Use centralized logging\n`;
        report += `5. Implement file integrity monitoring\n\n`;
        
        report += `## Legal and Ethical Considerations\n\n`;
        report += `⚠️ **WARNING**: Anti-forensics techniques should only be used:\n`;
        report += `- On systems you own\n`;
        report += `- With explicit written authorization\n`;
        report += `- In controlled testing environments\n`;
        report += `- Following responsible disclosure practices\n\n`;
        
        return report;
    }
}

function main() {
    console.log('Anti-Forensics Tool');
    console.log('='.repeat(50));
    console.log('⚠️ WARNING: This tool is for authorized security testing only!');
    console.log('⚠️ Only use on systems you own or have permission to test!\n');
    
    const tool = new AntiForensics();
    const report = tool.generateReport();
    
    const filename = 'anti_forensics_report.md';
    fs.writeFileSync(filename, report, 'utf8');
    
    console.log(`[+] Anti-forensics tool structure created`);
    console.log(`[+] Report saved to ${filename}`);
}

if (require.main === module) {
    main();
}

module.exports = AntiForensics;

