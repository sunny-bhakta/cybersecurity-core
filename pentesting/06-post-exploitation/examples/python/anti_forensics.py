#!/usr/bin/env python3
"""
Anti-Forensics Tool
Demonstrates anti-forensics techniques (for educational purposes).
"""

import sys
import os
import shutil
from typing import List

class AntiForensics:
    def __init__(self):
        self.techniques = []
    
    def secure_delete(self, file_path: str, passes: int = 3) -> bool:
        """Securely delete file"""
        print(f"[*] Securely deleting: {file_path}...")
        
        try:
            if os.path.exists(file_path):
                # Overwrite file multiple times
                file_size = os.path.getsize(file_path)
                with open(file_path, 'ba+', buffering=0) as f:
                    for _ in range(passes):
                        f.seek(0)
                        f.write(os.urandom(file_size))
                    f.truncate(0)
                
                os.remove(file_path)
                print(f"[+] File securely deleted: {file_path}")
                return True
        except Exception as e:
            print(f"[-] Error: {e}")
        
        return False
    
    def clear_metadata(self, file_path: str) -> bool:
        """Clear file metadata"""
        print(f"[*] Clearing metadata: {file_path}...")
        
        try:
            # Modify file timestamps
            import time
            current_time = time.time()
            os.utime(file_path, (current_time, current_time))
            print(f"[+] Metadata cleared: {file_path}")
            return True
        except Exception as e:
            print(f"[-] Error: {e}")
        
        return False
    
    def clear_history(self) -> bool:
        """Clear command history"""
        print("[*] Clearing command history...")
        
        history_files = [
            os.path.expanduser('~/.bash_history'),
            os.path.expanduser('~/.zsh_history'),
            os.path.expanduser('~/.history')
        ]
        
        cleared = False
        for hist_file in history_files:
            if os.path.exists(hist_file):
                try:
                    with open(hist_file, 'w') as f:
                        f.write('')
                    cleared = True
                except:
                    pass
        
        if cleared:
            print("[+] Command history cleared")
        
        return cleared
    
    def generate_report(self) -> str:
        """Generate anti-forensics report"""
        report = "# Anti-Forensics Report\n\n"
        
        report += "⚠️ **WARNING**: This tool is for educational purposes only!\n\n"
        
        report += "## Anti-Forensics Techniques\n\n"
        
        techniques = [
            "1. **Secure Deletion**: Overwrite files before deletion",
            "2. **Metadata Clearing**: Remove file metadata",
            "3. **History Clearing**: Clear command history",
            "4. **File Timestamp Manipulation**: Alter file times",
            "5. **Data Hiding**: Hide data in alternate data streams",
            "6. **Encryption**: Encrypt sensitive data"
        ]
        
        for technique in techniques:
            report += f"{technique}\n"
        report += "\n"
        
        report += "## Detection Methods\n\n"
        report += "1. **File Carving**: Recover deleted files\n"
        report += "2. **Metadata Analysis**: Analyze file metadata\n"
        report += "3. **Timeline Analysis**: Analyze file timestamps\n"
        report += "4. **Memory Analysis**: Analyze RAM for artifacts\n"
        report += "5. **Network Analysis**: Analyze network traffic\n\n"
        
        report += "## Prevention\n\n"
        report += "1. Use write-blockers for forensics\n"
        report += "2. Create forensic images immediately\n"
        report += "3. Monitor for anti-forensics activity\n"
        report += "4. Use centralized logging\n"
        report += "5. Implement file integrity monitoring\n\n"
        
        report += "## Legal and Ethical Considerations\n\n"
        report += "⚠️ **WARNING**: Anti-forensics techniques should only be used:\n"
        report += "- On systems you own\n"
        report += "- With explicit written authorization\n"
        report += "- In controlled testing environments\n"
        report += "- Following responsible disclosure practices\n\n"
        
        return report

def main():
    print("Anti-Forensics Tool")
    print("=" * 50)
    print("⚠️ WARNING: This tool is for authorized security testing only!")
    print("⚠️ Only use on systems you own or have permission to test!\n")
    
    tool = AntiForensics()
    report = tool.generate_report()
    
    filename = "anti_forensics_report.md"
    with open(filename, 'w') as f:
        f.write(report)
    
    print(f"[+] Anti-forensics tool structure created")
    print(f"[+] Report saved to {filename}")

if __name__ == "__main__":
    main()

