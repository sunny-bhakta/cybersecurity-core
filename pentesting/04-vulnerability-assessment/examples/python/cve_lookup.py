#!/usr/bin/env python3
"""
CVE Lookup Tool
Looks up CVE information from vulnerability databases.
"""

import sys
import requests
from typing import Dict

class CVELookup:
    def __init__(self):
        self.api_urls = {
            'nvd': 'https://services.nvd.nist.gov/rest/json/cves/2.0',
            'cve_mitre': 'https://cve.mitre.org/api/cve/'
        }
    
    def lookup_cve(self, cve_id: str) -> Dict:
        """Look up CVE information"""
        print(f"[*] Looking up CVE: {cve_id}...")
        
        info = {
            'id': cve_id,
            'description': '',
            'severity': '',
            'cvss_score': '',
            'published': '',
            'references': []
        }
        
        try:
            # Try NVD API
            url = f"{self.api_urls['nvd']}?cveId={cve_id}"
            response = requests.get(url, timeout=10)
            
            if response.status_code == 200:
                data = response.json()
                if 'vulnerabilities' in data and len(data['vulnerabilities']) > 0:
                    vuln = data['vulnerabilities'][0]['cve']
                    info['description'] = vuln.get('descriptions', [{}])[0].get('value', '')
                    info['published'] = vuln.get('published', '')
                    
                    # Get CVSS score
                    if 'metrics' in vuln:
                        metrics = vuln['metrics']
                        if 'cvssMetricV31' in metrics:
                            cvss = metrics['cvssMetricV31'][0]
                            info['cvss_score'] = cvss['cvssData']['baseScore']
                            info['severity'] = cvss['cvssData']['baseSeverity']
        except Exception as e:
            print(f"[-] Error: {e}")
        
        return info
    
    def search_by_keyword(self, keyword: str, limit: int = 10) -> List[Dict]:
        """Search CVEs by keyword"""
        print(f"[*] Searching CVEs for: {keyword}...")
        
        results = []
        
        try:
            url = f"{self.api_urls['nvd']}?keywordSearch={keyword}"
            response = requests.get(url, timeout=10)
            
            if response.status_code == 200:
                data = response.json()
                if 'vulnerabilities' in data:
                    for vuln in data['vulnerabilities'][:limit]:
                        cve = vuln['cve']
                        results.append({
                            'id': cve['id'],
                            'description': cve.get('descriptions', [{}])[0].get('value', '')[:100]
                        })
        except Exception as e:
            print(f"[-] Error: {e}")
        
        return results
    
    def generate_report(self, cve_id: str) -> str:
        """Generate CVE lookup report"""
        info = self.lookup_cve(cve_id)
        
        report = f"# CVE Lookup Report: {cve_id}\n\n"
        
        if info['description']:
            report += "## Description\n\n"
            report += f"{info['description']}\n\n"
        
        if info['severity']:
            report += "## Severity Information\n\n"
            report += f"**Severity**: {info['severity']}\n\n"
            report += f"**CVSS Score**: {info['cvss_score']}\n\n"
        
        if info['published']:
            report += f"**Published**: {info['published']}\n\n"
        
        report += "## References\n\n"
        report += f"- NVD: https://nvd.nist.gov/vuln/detail/{cve_id}\n"
        report += f"- MITRE: https://cve.mitre.org/cgi-bin/cvename.cgi?name={cve_id}\n\n"
        
        return report

def main():
    if len(sys.argv) < 2:
        print("Usage: python cve_lookup.py <CVE-ID>")
        print("Example: python cve_lookup.py CVE-2021-44228")
        sys.exit(1)
    
    cve_id = sys.argv[1]
    
    lookup = CVELookup()
    
    report = lookup.generate_report(cve_id)
    
    filename = f"cve_{cve_id.replace('-', '_')}.md"
    with open(filename, 'w') as f:
        f.write(report)
    
    print(f"[+] CVE lookup complete for {cve_id}")
    print(f"[+] Report saved to {filename}")

if __name__ == '__main__':
    main()


