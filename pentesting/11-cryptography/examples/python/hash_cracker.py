#!/usr/bin/env python3
"""
Hash Cracker
Cracks password hashes using dictionary and brute force attacks.
"""

import hashlib
import sys
from typing import Optional, List
from itertools import product
import string

class HashCracker:
    def __init__(self):
        self.hash_functions = {
            'md5': hashlib.md5,
            'sha1': hashlib.sha1,
            'sha256': hashlib.sha256,
            'sha512': hashlib.sha512
        }
    
    def identify_hash(self, hash_value: str) -> Optional[str]:
        """Identify hash type based on length"""
        length = len(hash_value)
        
        hash_types = {
            32: 'md5',
            40: 'sha1',
            64: 'sha256',
            128: 'sha512'
        }
        
        return hash_types.get(length)
    
    def hash_password(self, password: str, algorithm: str = 'md5') -> str:
        """Hash a password using specified algorithm"""
        if algorithm not in self.hash_functions:
            raise ValueError(f"Unsupported algorithm: {algorithm}")
        
        hash_func = self.hash_functions[algorithm]
        return hash_func(password.encode()).hexdigest()
    
    def dictionary_attack(self, hash_value: str, wordlist: List[str],
                         algorithm: str = 'md5') -> Optional[str]:
        """Perform dictionary attack"""
        print(f"[*] Starting dictionary attack ({len(wordlist)} words)...")
        
        for i, word in enumerate(wordlist):
            if i % 1000 == 0:
                print(f"[*] Tried {i} passwords...")
            
            hashed = self.hash_password(word, algorithm)
            if hashed == hash_value:
                print(f"[+] Password found: {word}")
                return word
        
        print("[-] Password not found in dictionary")
        return None
    
    def brute_force_attack(self, hash_value: str, max_length: int = 4,
                          algorithm: str = 'md5', charset: str = string.ascii_lowercase) -> Optional[str]:
        """Perform brute force attack"""
        print(f"[*] Starting brute force attack (max length: {max_length})...")
        
        for length in range(1, max_length + 1):
            print(f"[*] Trying length {length}...")
            for attempt in product(charset, repeat=length):
                password = ''.join(attempt)
                hashed = self.hash_password(password, algorithm)
                
                if hashed == hash_value:
                    print(f"[+] Password found: {password}")
                    return password
        
        print("[-] Password not found")
        return None
    
    def hybrid_attack(self, hash_value: str, wordlist: List[str],
                     algorithm: str = 'md5', suffixes: List[str] = ['123', '!', '2024']) -> Optional[str]:
        """Perform hybrid attack (dictionary + common suffixes)"""
        print(f"[*] Starting hybrid attack...")
        
        for word in wordlist:
            # Try word as-is
            hashed = self.hash_password(word, algorithm)
            if hashed == hash_value:
                print(f"[+] Password found: {word}")
                return word
            
            # Try with suffixes
            for suffix in suffixes:
                password = word + suffix
                hashed = self.hash_password(password, algorithm)
                if hashed == hash_value:
                    print(f"[+] Password found: {password}")
                    return password
        
        print("[-] Password not found")
        return None
    
    def crack_hash(self, hash_value: str, wordlist: List[str] = None,
                  algorithm: str = None, method: str = 'dictionary') -> Optional[str]:
        """Crack a hash using specified method"""
        if not algorithm:
            algorithm = self.identify_hash(hash_value)
            if not algorithm:
                print("[-] Could not identify hash type")
                return None
            print(f"[+] Identified hash type: {algorithm}")
        
        if method == 'dictionary' and wordlist:
            return self.dictionary_attack(hash_value, wordlist, algorithm)
        elif method == 'bruteforce':
            return self.brute_force_attack(hash_value, algorithm=algorithm)
        elif method == 'hybrid' and wordlist:
            return self.hybrid_attack(hash_value, wordlist, algorithm)
        else:
            print("[-] Invalid method or missing wordlist")
            return None

def main():
    cracker = HashCracker()
    
    if len(sys.argv) < 2:
        print("Usage: python hash_cracker.py <hash> [wordlist_file] [algorithm] [method]")
        print("Example: python hash_cracker.py 5f4dcc3b5aa765d61d8327deb882cf99 wordlist.txt md5 dictionary")
        print("         python hash_cracker.py 5f4dcc3b5aa765d61d8327deb882cf99 wordlist.txt md5 hybrid")
        print("         python hash_cracker.py 5f4dcc3b5aa765d61d8327deb882cf99 '' md5 bruteforce")
        sys.exit(1)
    
    hash_value = sys.argv[1]
    wordlist_file = sys.argv[2] if len(sys.argv) > 2 and sys.argv[2] else None
    algorithm = sys.argv[3] if len(sys.argv) > 3 else None
    method = sys.argv[4] if len(sys.argv) > 4 else 'dictionary'
    
    wordlist = []
    if wordlist_file:
        try:
            with open(wordlist_file, 'r', encoding='utf-8', errors='ignore') as f:
                wordlist = [line.strip() for line in f if line.strip()]
            print(f"[+] Loaded {len(wordlist)} words from {wordlist_file}")
        except FileNotFoundError:
            print(f"[-] Wordlist file not found: {wordlist_file}")
            sys.exit(1)
    
    password = cracker.crack_hash(hash_value, wordlist, algorithm, method)
    
    if password:
        print(f"\n[+] SUCCESS: Password is '{password}'")
    else:
        print(f"\n[-] FAILED: Could not crack hash")

if __name__ == '__main__':
    main()

