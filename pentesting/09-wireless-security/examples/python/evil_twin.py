#!/usr/bin/env python3
"""
Evil Twin Tool
Creates fake access points (Evil Twin) for security testing.
"""

import sys
from typing import Dict

class EvilTwin:
    def __init__(self, ssid: str, interface: str):
        self.ssid = ssid
        self.interface = interface
        self.fake_ap_created = False
    
    def create_fake_ap(self, channel: int = 6) -> bool:
        """Create fake access point"""
        print(f"[*] Creating fake AP: {self.ssid} on channel {channel}...")
        
        # In real implementation, would use hostapd or similar
        print("[!] Note: Real implementation requires:")
        print("    - Root privileges")
        print("    - hostapd or airbase-ng")
        print("    - Wireless interface support for AP mode")
        
        return False
    
    def setup_captive_portal(self) -> bool:
        """Setup captive portal for credential harvesting"""
        print("[*] Setting up captive portal...")
        
        # In real implementation, would setup web server
        print("[!] Note: Real implementation requires web server setup")
        
        return False
    
    def start_evil_twin(self) -> bool:
        """Start evil twin attack"""
        print(f"[*] Starting Evil Twin attack for SSID: {self.ssid}...")
        
        self.create_fake_ap()
        self.setup_captive_portal()
        
        return True
    
    def generate_report(self) -> str:
        """Generate Evil Twin report"""
        report = f"# Evil Twin Attack Report for {self.ssid}\n\n"
        
        report += f"**SSID**: {self.ssid}\n\n"
        report += f"**Interface**: {self.interface}\n\n"
        
        report += "## Evil Twin Overview\n\n"
        report += "An Evil Twin is a fake wireless access point that mimics a legitimate AP\n"
        report += "to trick users into connecting and potentially stealing credentials or data.\n\n"
        
        report += "## Attack Process\n\n"
        report += "1. Create fake access point with same SSID\n"
        report += "2. Use stronger signal or deauthenticate legitimate AP\n"
        report += "3. Users connect to fake AP\n"
        report += "4. Capture credentials or perform MITM attacks\n\n"
        
        report += "## Common Techniques\n\n"
        report += "1. **SSID Spoofing**: Use identical SSID\n"
        report += "2. **Signal Strength**: Use stronger signal\n"
        report += "3. **Deauthentication**: Force disconnection from real AP\n"
        report += "4. **Captive Portal**: Fake login page\n"
        report += "5. **SSL Stripping**: Downgrade HTTPS to HTTP\n\n"
        
        report += "## Detection Methods\n\n"
        report += "1. **BSSID Verification**: Check MAC addresses\n"
        report += "2. **Certificate Validation**: Verify SSL certificates\n"
        report += "3. **Network Monitoring**: Monitor for duplicate SSIDs\n"
        report += "4. **Signal Analysis**: Analyze signal characteristics\n\n"
        
        report += "## Prevention\n\n"
        report += "1. Verify BSSID before connecting\n"
        report += "2. Use certificate pinning\n"
        report += "3. Monitor for duplicate SSIDs\n"
        report += "4. Use VPNs on public networks\n"
        report += "5. Educate users about risks\n\n"
        
        report += "## Legal and Ethical Considerations\n\n"
        report += "⚠️ **WARNING**: Evil Twin attacks should only be performed:\n"
        report += "- On networks you own\n"
        report += "- With explicit written authorization\n"
        report += "- In controlled testing environments\n"
        report += "- Following responsible disclosure practices\n"
        report += "- **Creating fake APs may be illegal!**\n\n"
        
        return report

def main():
    if len(sys.argv) < 3:
        print("Usage: python evil_twin.py <ssid> <interface>")
        print("Example: python evil_twin.py MyNetwork wlan0")
        print("\n⚠️ WARNING: Only use for authorized security testing!")
        sys.exit(1)
    
    ssid = sys.argv[1]
    interface = sys.argv[2]
    
    evil_twin = EvilTwin(ssid, interface)
    evil_twin.start_evil_twin()
    
    report = evil_twin.generate_report()
    
    filename = f"evil_twin_{ssid.replace(' ', '_')}.md"
    with open(filename, 'w') as f:
        f.write(report)
    
    print(f"[+] Evil Twin tool structure created")
    print(f"[+] Report saved to {filename}")
    print("[!] WARNING: Only test networks you own or have permission to test!")

if __name__ == "__main__":
    main()

