#!/usr/bin/env node
/**
 * Evil Twin Tool
 * Creates fake access points (Evil Twin) for security testing.
 */

const fs = require('fs');

class EvilTwin {
    constructor(ssid, interface) {
        this.ssid = ssid;
        this.interface = interface;
        this.fakeApCreated = false;
    }

    createFakeAp(channel = 6) {
        console.log(`[*] Creating fake AP: ${this.ssid} on channel ${channel}...`);
        
        console.log('[!] Note: Real implementation requires:');
        console.log('    - Root privileges');
        console.log('    - hostapd or airbase-ng');
        console.log('    - Wireless interface support for AP mode');
        
        return false;
    }

    setupCaptivePortal() {
        console.log('[*] Setting up captive portal...');
        
        console.log('[!] Note: Real implementation requires web server setup');
        
        return false;
    }

    startEvilTwin() {
        console.log(`[*] Starting Evil Twin attack for SSID: ${this.ssid}...`);
        
        this.createFakeAp();
        this.setupCaptivePortal();
        
        return true;
    }

    generateReport() {
        let report = `# Evil Twin Attack Report for ${this.ssid}\n\n`;
        
        report += `**SSID**: ${this.ssid}\n\n`;
        report += `**Interface**: ${this.interface}\n\n`;
        
        report += `## Evil Twin Overview\n\n`;
        report += `An Evil Twin is a fake wireless access point that mimics a legitimate AP\n`;
        report += `to trick users into connecting and potentially stealing credentials or data.\n\n`;
        
        report += `## Attack Process\n\n`;
        report += `1. Create fake access point with same SSID\n`;
        report += `2. Use stronger signal or deauthenticate legitimate AP\n`;
        report += `3. Users connect to fake AP\n`;
        report += `4. Capture credentials or perform MITM attacks\n\n`;
        
        report += `## Common Techniques\n\n`;
        report += `1. **SSID Spoofing**: Use identical SSID\n`;
        report += `2. **Signal Strength**: Use stronger signal\n`;
        report += `3. **Deauthentication**: Force disconnection from real AP\n`;
        report += `4. **Captive Portal**: Fake login page\n`;
        report += `5. **SSL Stripping**: Downgrade HTTPS to HTTP\n\n`;
        
        report += `## Detection Methods\n\n`;
        report += `1. **BSSID Verification**: Check MAC addresses\n`;
        report += `2. **Certificate Validation**: Verify SSL certificates\n`;
        report += `3. **Network Monitoring**: Monitor for duplicate SSIDs\n`;
        report += `4. **Signal Analysis**: Analyze signal characteristics\n\n`;
        
        report += `## Prevention\n\n`;
        report += `1. Verify BSSID before connecting\n`;
        report += `2. Use certificate pinning\n`;
        report += `3. Monitor for duplicate SSIDs\n`;
        report += `4. Use VPNs on public networks\n`;
        report += `5. Educate users about risks\n\n`;
        
        report += `## Legal and Ethical Considerations\n\n`;
        report += `⚠️ **WARNING**: Evil Twin attacks should only be performed:\n`;
        report += `- On networks you own\n`;
        report += `- With explicit written authorization\n`;
        report += `- In controlled testing environments\n`;
        report += `- Following responsible disclosure practices\n`;
        report += `- **Creating fake APs may be illegal!**\n\n`;
        
        return report;
    }
}

function main() {
    if (process.argv.length < 4) {
        console.log('Usage: node evil_twin.js <ssid> <interface>');
        console.log('Example: node evil_twin.js MyNetwork wlan0');
        console.log('\n⚠️ WARNING: Only use for authorized security testing!');
        process.exit(1);
    }
    
    const ssid = process.argv[2];
    const interface = process.argv[3];
    
    const evilTwin = new EvilTwin(ssid, interface);
    evilTwin.startEvilTwin();
    
    const report = evilTwin.generateReport();
    
    const filename = `evil_twin_${ssid.replace(/ /g, '_')}.md`;
    fs.writeFileSync(filename, report, 'utf8');
    
    console.log(`[+] Evil Twin tool structure created`);
    console.log(`[+] Report saved to ${filename}`);
    console.log(`[!] WARNING: Only test networks you own or have permission to test!`);
}

if (require.main === module) {
    main();
}

module.exports = EvilTwin;

