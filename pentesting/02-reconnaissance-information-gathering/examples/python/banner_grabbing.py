#!/usr/bin/env python3
"""
Banner Grabbing Tool
Grabs service banners to identify versions and technologies.
"""

import sys
import socket
from typing import Dict

class BannerGrabber:
    def __init__(self, target: str, port: int):
        self.target = target
        self.port = port
        self.banner = None
    
    def grab_banner(self, timeout: int = 5) -> str:
        """Grab service banner"""
        print(f"[*] Grabbing banner from {self.target}:{self.port}...")
        
        try:
            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            sock.settimeout(timeout)
            sock.connect((self.target, self.port))
            
            # Try to receive banner
            banner = sock.recv(1024).decode('utf-8', errors='ignore').strip()
            sock.close()
            
            self.banner = banner
            return banner
        except Exception as e:
            print(f"[-] Error: {e}")
            return None
    
    def grab_http_banner(self) -> Dict:
        """Grab HTTP banner"""
        try:
            import requests
            response = requests.get(f"http://{self.target}:{self.port}", timeout=5)
            return {
                'server': response.headers.get('Server', 'Unknown'),
                'powered_by': response.headers.get('X-Powered-By', 'Unknown'),
                'version': self.extract_version(response.headers.get('Server', ''))
            }
        except:
            return {}
    
    def extract_version(self, banner: str) -> str:
        """Extract version from banner"""
        # Simple version extraction
        import re
        version_match = re.search(r'(\d+\.\d+(?:\.\d+)?)', banner)
        return version_match.group(1) if version_match else 'Unknown'
    
    def generate_report(self) -> str:
        """Generate banner grabbing report"""
        banner = self.grab_banner()
        
        report = f"# Banner Grabbing Report for {self.target}:{self.port}\n\n"
        
        if banner:
            report += "## Banner\n\n"
            report += f"```\n{banner}\n```\n\n"
            
            # HTTP-specific
            if self.port in [80, 443, 8080, 8443]:
                http_info = self.grab_http_banner()
                if http_info:
                    report += "## HTTP Headers\n\n"
                    report += f"**Server**: {http_info.get('server', 'Unknown')}\n\n"
                    report += f"**X-Powered-By**: {http_info.get('powered_by', 'Unknown')}\n\n"
        else:
            report += "[-] Could not grab banner.\n\n"
        
        report += "## Usage\n\n"
        report += "Banner information can reveal:\n"
        report += "- Service versions\n"
        report += "- Technology stack\n"
        report += "- Potential vulnerabilities\n\n"
        
        return report

def main():
    if len(sys.argv) < 3:
        print("Usage: python banner_grabbing.py <target> <port>")
        print("Example: python banner_grabbing.py 192.168.1.100 22")
        sys.exit(1)
    
    target = sys.argv[1]
    port = int(sys.argv[2])
    
    grabber = BannerGrabber(target, port)
    
    report = grabber.generate_report()
    
    filename = f"banner_{target.replace('.', '_')}_{port}.md"
    with open(filename, 'w') as f:
        f.write(report)
    
    print(f"[+] Banner grabbing complete")
    print(f"[+] Report saved to {filename}")

if __name__ == '__main__':
    main()


