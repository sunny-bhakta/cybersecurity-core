#!/usr/bin/env node
/**
 * Social Media Intelligence Tool
 * Gathers intelligence from social media platforms.
 */

const https = require('https');
const http = require('http');
const fs = require('fs');

class SocialMediaIntelligence {
    constructor(target) {
        this.target = target;
        this.findings = [];
    }

    async searchTwitter() {
        console.log(`[*] Searching Twitter for mentions of: ${this.target}...`);
        const results = [];
        // In real implementation, would use Twitter API
        console.log('[!] Note: Real implementation requires Twitter API credentials');
        return results;
    }

    async searchLinkedIn() {
        console.log(`[*] Searching LinkedIn for: ${this.target}...`);
        const results = [];
        // In real implementation, would use LinkedIn API or scraping
        console.log('[!] Note: LinkedIn requires authentication and has rate limits');
        return results;
    }

    async searchGitHub() {
        console.log(`[*] Searching GitHub for: ${this.target}...`);
        const results = [];
        
        try {
            const url = `https://api.github.com/search/repositories?q=${this.target}`;
            const data = await this.makeRequest(url);
            
            if (data.items) {
                data.items.slice(0, 10).forEach(item => {
                    results.push({
                        name: item.name || '',
                        url: item.html_url || '',
                        description: item.description || ''
                    });
                });
            }
        } catch (err) {
            console.log(`[-] Error: ${err.message}`);
        }
        
        return results;
    }

    async searchReddit() {
        console.log(`[*] Searching Reddit for: ${this.target}...`);
        const results = [];
        
        try {
            const url = `https://www.reddit.com/search.json?q=${this.target}`;
            const data = await this.makeRequest(url, {
                'User-Agent': 'OSINT-Tool/1.0'
            });
            
            if (data.data && data.data.children) {
                data.data.children.slice(0, 10).forEach(item => {
                    const post = item.data || {};
                    results.push({
                        title: post.title || '',
                        url: post.url || '',
                        subreddit: post.subreddit || ''
                    });
                });
            }
        } catch (err) {
            console.log(`[-] Error: ${err.message}`);
        }
        
        return results;
    }

    makeRequest(url, headers = {}) {
        return new Promise((resolve, reject) => {
            const protocol = url.startsWith('https') ? https : http;
            
            protocol.get(url, { headers, timeout: 10000 }, (res) => {
                let data = '';
                res.on('data', (chunk) => {
                    data += chunk;
                });
                res.on('end', () => {
                    try {
                        resolve(JSON.parse(data));
                    } catch (e) {
                        resolve(data);
                    }
                });
            }).on('error', (err) => {
                reject(err);
            });
        });
    }

    async searchAll() {
        console.log(`[*] Starting social media intelligence gathering for: ${this.target}\n`);
        
        const results = {
            twitter: await this.searchTwitter(),
            linkedin: await this.searchLinkedIn(),
            github: await this.searchGitHub(),
            reddit: await this.searchReddit()
        };
        
        return results;
    }

    generateReport(results) {
        let report = `# Social Media Intelligence Report for ${this.target}\n\n`;
        
        if (results.github && results.github.length > 0) {
            report += `## GitHub Repositories\n\n`;
            results.github.forEach(repo => {
                report += `- **${repo.name}**: ${repo.description || 'No description'}\n`;
                report += `  - URL: ${repo.url}\n`;
            });
            report += `\n`;
        }
        
        if (results.reddit && results.reddit.length > 0) {
            report += `## Reddit Mentions\n\n`;
            results.reddit.forEach(post => {
                report += `- **${post.title}**\n`;
                report += `  - Subreddit: r/${post.subreddit}\n`;
                report += `  - URL: ${post.url}\n`;
            });
            report += `\n`;
        }
        
        if (results.twitter && results.twitter.length > 0) {
            report += `## Twitter Mentions\n\n`;
            results.twitter.forEach(tweet => {
                report += `- ${tweet}\n`;
            });
            report += `\n`;
        }
        
        if (results.linkedin && results.linkedin.length > 0) {
            report += `## LinkedIn Information\n\n`;
            results.linkedin.forEach(item => {
                report += `- ${item}\n`;
            });
            report += `\n`;
        }
        
        report += `## Legal and Ethical Considerations\n\n`;
        report += `⚠️ **WARNING**: Social media intelligence gathering must comply with:\n`;
        report += `1. **Terms of Service**: Respect each platform's ToS\n`;
        report += `2. **Privacy Laws**: GDPR, CCPA, and other privacy regulations\n`;
        report += `3. **Rate Limits**: Respect API rate limits\n`;
        report += `4. **Ethical Use**: Only gather publicly available information\n`;
        report += `5. **Authorization**: Only use for authorized investigations\n\n`;
        
        return report;
    }
}

// Main execution
async function main() {
    if (process.argv.length < 3) {
        console.log('Usage: node social_media_intelligence.js <target>');
        console.log('Example: node social_media_intelligence.js example.com');
        process.exit(1);
    }
    
    const target = process.argv[2];
    
    const tool = new SocialMediaIntelligence(target);
    
    const results = await tool.searchAll();
    const report = tool.generateReport(results);
    
    const filename = `social_media_intel_${target.replace(/\./g, '_')}.md`;
    fs.writeFileSync(filename, report, 'utf8');
    
    console.log(`\n[+] Social media intelligence gathering complete`);
    console.log(`[+] Report saved to ${filename}`);
    console.log(`[!] WARNING: Only use for authorized investigations!`);
}

if (require.main === module) {
    main().catch(console.error);
}

module.exports = SocialMediaIntelligence;

