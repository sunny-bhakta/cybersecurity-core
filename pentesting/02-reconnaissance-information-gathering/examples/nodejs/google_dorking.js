/**
 * Google Dorking Tool
 * Performs advanced Google searches to find sensitive information.
 */

const fs = require('fs');

class GoogleDorking {
    constructor() {
        this.dorks = [];
    }

    buildDork(site = null, filetype = null, inurl = null, intitle = null, intext = null) {
        const queryParts = [];

        if (site) queryParts.push(`site:${site}`);
        if (filetype) queryParts.push(`filetype:${filetype}`);
        if (inurl) queryParts.push(`inurl:${inurl}`);
        if (intitle) queryParts.push(`intitle:${intitle}`);
        if (intext) queryParts.push(`intext:${intext}`);

        return queryParts.join(' ');
    }

    generateCommonDorks(domain) {
        return [
            {
                name: 'PDF Files',
                query: this.buildDork(domain, 'pdf'),
                description: 'Find PDF files on the domain'
            },
            {
                name: 'Configuration Files',
                query: this.buildDork(domain, 'conf'),
                description: 'Find configuration files'
            },
            {
                name: 'Admin Panels',
                query: this.buildDork(domain, null, 'admin'),
                description: 'Find admin panels'
            },
            {
                name: 'Login Pages',
                query: this.buildDork(domain, null, 'login'),
                description: 'Find login pages'
            },
            {
                name: 'Index of Directories',
                query: this.buildDork(domain, null, null, 'index of'),
                description: 'Find directory listings'
            },
            {
                name: 'API Keys',
                query: this.buildDork(domain, null, null, null, 'api_key'),
                description: 'Find potential API keys'
            },
            {
                name: 'Private Keys',
                query: this.buildDork(domain, 'pem'),
                description: 'Find private key files'
            }
        ];
    }

    formatGoogleUrl(query) {
        const encoded = encodeURIComponent(query);
        return `https://www.google.com/search?q=${encoded}`;
    }

    generateReport(domain) {
        const dorks = this.generateCommonDorks(domain);

        let report = `# Google Dorking Report for ${domain}\n\n`;
        report += `## Generated Dorks\n\n`;
        report += `**Note**: These are search queries. Copy and paste them into Google Search.\n\n`;

        dorks.forEach((dork, i) => {
            report += `### ${i + 1}. ${dork.name}\n\n`;
            report += `**Description**: ${dork.description}\n\n`;
            report += `**Query**: \`${dork.query}\`\n\n`;
            report += `**Google URL**: ${this.formatGoogleUrl(dork.query)}\n\n`;
            report += `---\n\n`;
        });

        report += `## Legal Warning\n\n`;
        report += `⚠️ **WARNING**: Only use these queries on domains you own or have permission to test!\n`;

        return report;
    }
}

function main() {
    const args = process.argv.slice(2);
    if (args.length < 1) {
        console.log('Usage: node google_dorking.js <domain>');
        console.log('Example: node google_dorking.js example.com');
        process.exit(1);
    }

    const domain = args[0];
    const dorking = new GoogleDorking();

    const report = dorking.generateReport(domain);
    const filename = `google_dorks_${domain.replace(/\./g, '_')}.md`;

    fs.writeFileSync(filename, report, 'utf8');

    console.log(`[+] Generated ${dorking.generateCommonDorks(domain).length} Google dorks for ${domain}`);
    console.log(`[+] Report saved to ${filename}`);
    console.log(`[!] WARNING: Only use on domains you own or have permission to test!`);
}

if (require.main === module) {
    main();
}

module.exports = GoogleDorking;

