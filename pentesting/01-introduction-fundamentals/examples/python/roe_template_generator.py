#!/usr/bin/env python3
"""
Rules of Engagement (ROE) Template Generator
Generates a customizable ROE document for penetration testing engagements.
"""

import datetime
from typing import Dict, List

class ROETemplateGenerator:
    def __init__(self):
        self.template = {
            'client_name': '',
            'project_name': '',
            'date': datetime.datetime.now().strftime('%Y-%m-%d'),
            'scope': [],
            'out_of_scope': [],
            'testing_windows': [],
            'contacts': {},
            'emergency_procedures': {},
            'data_handling': {},
            'reporting': {}
        }
    
    def generate_roe(self, config: Dict) -> str:
        """Generate ROE document from configuration"""
        roe_doc = f"""
# RULES OF ENGAGEMENT (ROE)
## Penetration Testing Engagement

**Client**: {config.get('client_name', 'N/A')}
**Project**: {config.get('project_name', 'N/A')}
**Date**: {config.get('date', datetime.datetime.now().strftime('%Y-%m-%d'))}
**Engagement Type**: {config.get('engagement_type', 'N/A')}

---

## 1. SCOPE OF ENGAGEMENT

### In-Scope Systems
"""
        for item in config.get('scope', []):
            roe_doc += f"- {item}\n"
        
        roe_doc += "\n### Out-of-Scope Systems\n"
        for item in config.get('out_of_scope', []):
            roe_doc += f"- {item}\n"
        
        roe_doc += f"""
---

## 2. TESTING WINDOWS

"""
        for window in config.get('testing_windows', []):
            roe_doc += f"- **{window.get('name', 'Window')}**: {window.get('time', 'N/A')}\n"
        
        roe_doc += f"""
---

## 3. CONTACT INFORMATION

### Client Contacts
- **Primary Contact**: {config.get('contacts', {}).get('primary', 'N/A')}
- **Technical Contact**: {config.get('contacts', {}).get('technical', 'N/A')}
- **Emergency Contact**: {config.get('contacts', {}).get('emergency', 'N/A')}

### Testing Team Contacts
- **Lead Tester**: {config.get('contacts', {}).get('lead_tester', 'N/A')}
- **Project Manager**: {config.get('contacts', {}).get('project_manager', 'N/A')}

---

## 4. AUTHORIZATION

This penetration test is authorized by:
- **Authorized By**: {config.get('authorization', {}).get('authorized_by', 'N/A')}
- **Authorization Date**: {config.get('authorization', {}).get('date', 'N/A')}
- **Authorization Reference**: {config.get('authorization', {}).get('reference', 'N/A')}

---

## 5. TESTING METHODOLOGY

**Methodology**: {config.get('methodology', 'PTES - Penetration Testing Execution Standard')}

**Testing Approach**: {config.get('testing_approach', 'Gray Box')}

---

## 6. RESTRICTIONS AND LIMITATIONS

### Prohibited Activities
"""
        for activity in config.get('prohibited_activities', []):
            roe_doc += f"- {activity}\n"
        
        roe_doc += f"""
### Rate Limiting
- **Request Rate**: {config.get('rate_limiting', {}).get('max_requests_per_second', 'N/A')} requests/second
- **Concurrent Connections**: {config.get('rate_limiting', {}).get('max_concurrent', 'N/A')}

---

## 7. EMERGENCY PROCEDURES

### Incident Response
{config.get('emergency_procedures', {}).get('incident_response', 'Contact emergency contact immediately')}

### Service Disruption
{config.get('emergency_procedures', {}).get('service_disruption', 'Stop all testing activities immediately')}

### Emergency Contact
- **Phone**: {config.get('emergency_procedures', {}).get('phone', 'N/A')}
- **Email**: {config.get('emergency_procedures', {}).get('email', 'N/A')}

---

## 8. DATA HANDLING

### Data Collection
{config.get('data_handling', {}).get('collection', 'Only collect data necessary for testing')}

### Data Storage
{config.get('data_handling', {}).get('storage', 'Store data in encrypted format')}

### Data Retention
{config.get('data_handling', {}).get('retention', 'Retain data for 30 days after engagement completion')}

### Data Destruction
{config.get('data_handling', {}).get('destruction', 'Securely delete all collected data after retention period')}

---

## 9. REPORTING REQUIREMENTS

### Report Deliverables
"""
        for deliverable in config.get('reporting', {}).get('deliverables', []):
            roe_doc += f"- {deliverable}\n"
        
        roe_doc += f"""
### Report Timeline
- **Draft Report**: {config.get('reporting', {}).get('draft_timeline', 'N/A')}
- **Final Report**: {config.get('reporting', {}).get('final_timeline', 'N/A')}

---

## 10. LEGAL AND COMPLIANCE

### Compliance Requirements
"""
        for requirement in config.get('compliance', []):
            roe_doc += f"- {requirement}\n"
        
        roe_doc += f"""
---

## 11. SIGNATURES

**Client Signature**: _________________ Date: _______

**Testing Team Signature**: _________________ Date: _______

---

**Document Version**: 1.0
**Last Updated**: {datetime.datetime.now().strftime('%Y-%m-%d')}

**IMPORTANT**: This document must be signed by authorized personnel before testing begins.
"""
        return roe_doc
    
    def save_roe(self, config: Dict, filename: str = 'roe_document.md'):
        """Save ROE document to file"""
        roe_content = self.generate_roe(config)
        with open(filename, 'w') as f:
            f.write(roe_content)
        print(f"[+] ROE document saved to {filename}")

def main():
    """Example usage"""
    generator = ROETemplateGenerator()
    
    # Example configuration
    config = {
        'client_name': 'Example Corporation',
        'project_name': 'Web Application Security Assessment',
        'engagement_type': 'Gray Box Penetration Test',
        'scope': [
            'https://example.com',
            'https://api.example.com',
            'Internal network (192.168.1.0/24)'
        ],
        'out_of_scope': [
            'Production database servers',
            'Third-party services',
            'Social engineering attacks'
        ],
        'testing_windows': [
            {'name': 'Weekdays', 'time': '09:00 - 17:00 EST'},
            {'name': 'Weekends', 'time': 'No testing'}
        ],
        'contacts': {
            'primary': 'client@example.com',
            'technical': 'tech@example.com',
            'emergency': '+1-555-0123',
            'lead_tester': 'tester@securityfirm.com',
            'project_manager': 'pm@securityfirm.com'
        },
        'authorization': {
            'authorized_by': 'John Doe, CISO',
            'date': '2024-01-15',
            'reference': 'AUTH-2024-001'
        },
        'methodology': 'PTES - Penetration Testing Execution Standard',
        'testing_approach': 'Gray Box',
        'prohibited_activities': [
            'Denial of Service (DoS) attacks',
            'Physical security testing',
            'Social engineering',
            'Data exfiltration beyond testing needs'
        ],
        'rate_limiting': {
            'max_requests_per_second': '10',
            'max_concurrent': '5'
        },
        'emergency_procedures': {
            'incident_response': 'Contact emergency contact immediately',
            'service_disruption': 'Stop all testing activities immediately',
            'phone': '+1-555-0123',
            'email': 'emergency@example.com'
        },
        'data_handling': {
            'collection': 'Only collect data necessary for testing',
            'storage': 'Store data in encrypted format on secure servers',
            'retention': '30 days after engagement completion',
            'destruction': 'Securely delete using DoD 5220.22-M standard'
        },
        'reporting': {
            'deliverables': [
                'Executive Summary',
                'Technical Findings Report',
                'Remediation Recommendations',
                'Raw Data (upon request)'
            ],
            'draft_timeline': '5 business days after testing completion',
            'final_timeline': '10 business days after testing completion'
        },
        'compliance': [
            'GDPR compliance required',
            'PCI DSS considerations',
            'Internal security policies'
        ]
    }
    
    generator.save_roe(config, 'roe_document.md')
    print("\n[+] ROE template generated successfully!")
    print("[!] Review and customize the generated document before use.")

if __name__ == '__main__':
    main()

