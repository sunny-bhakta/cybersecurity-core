#!/usr/bin/env python3
"""
Methodology Templates Generator
Generates templates for various penetration testing methodologies.
"""

import sys
from typing import Dict, List

class MethodologyTemplates:
    def __init__(self):
        self.methodologies = {
            'owasp': {
                'name': 'OWASP Testing Guide',
                'phases': [
                    'Information Gathering',
                    'Configuration and Deployment Management Testing',
                    'Identity Management Testing',
                    'Authentication Testing',
                    'Authorization Testing',
                    'Session Management Testing',
                    'Input Validation Testing',
                    'Error Handling Testing',
                    'Cryptography Testing',
                    'Business Logic Testing',
                    'Client-Side Testing'
                ]
            },
            'ptes': {
                'name': 'PTES (Penetration Testing Execution Standard)',
                'phases': [
                    'Pre-engagement Interactions',
                    'Intelligence Gathering',
                    'Threat Modeling',
                    'Vulnerability Analysis',
                    'Exploitation',
                    'Post Exploitation',
                    'Reporting'
                ]
            },
            'nist': {
                'name': 'NIST SP 800-115',
                'phases': [
                    'Planning',
                    'Discovery',
                    'Attack',
                    'Reporting'
                ]
            },
            'osstmm': {
                'name': 'OSSTMM (Open Source Security Testing Methodology Manual)',
                'phases': [
                    'Regulatory',
                    'Posture Review',
                    'Logistics',
                    'Active Detection Verification',
                    'Visibility Audit',
                    'Access Verification',
                    'Trust Verification',
                    'Service Verification',
                    'Control Verification',
                    'Process Verification',
                    'Configuration Verification',
                    'Integrity Verification',
                    'Alarm Verification',
                    'Segmentation Verification'
                ]
            }
        }
    
    def generate_methodology_template(self, methodology: str) -> str:
        """Generate template for a specific methodology"""
        if methodology.lower() not in self.methodologies:
            return f"Unknown methodology: {methodology}"
        
        meth = self.methodologies[methodology.lower()]
        
        doc = f"""# {meth['name']} Penetration Testing Template

## Methodology Overview

This document follows the **{meth['name']}** methodology for penetration testing.

---

## Testing Phases

"""
        for i, phase in enumerate(meth['phases'], 1):
            doc += f"### Phase {i}: {phase}\n\n"
            doc += "**Status**: ⏳ Not Started\n\n"
            doc += "**Objectives**:\n"
            doc += "- [ ] Objective 1\n"
            doc += "- [ ] Objective 2\n"
            doc += "- [ ] Objective 3\n\n"
            doc += "**Tools Used**:\n"
            doc += "- Tool 1\n"
            doc += "- Tool 2\n\n"
            doc += "**Findings**:\n"
            doc += "- Finding 1\n"
            doc += "- Finding 2\n\n"
            doc += "**Notes**:\n"
            doc += "Add notes here...\n\n"
            doc += "---\n\n"
        
        doc += "\n## Testing Checklist\n\n"
        doc += "### Pre-Engagement\n\n"
        doc += "- [ ] Scope defined and approved\n"
        doc += "- [ ] Rules of engagement established\n"
        doc += "- [ ] Legal authorization obtained\n"
        doc += "- [ ] Communication channels established\n"
        doc += "- [ ] Testing environment prepared\n\n"
        
        doc += "### During Testing\n\n"
        doc += "- [ ] All phases documented\n"
        doc += "- [ ] Evidence collected for all findings\n"
        doc += "- [ ] Critical findings reported immediately\n"
        doc += "- [ ] Testing activities logged\n\n"
        
        doc += "### Post-Engagement\n\n"
        doc += "- [ ] Final report prepared\n"
        doc += "- [ ] Findings validated\n"
        doc += "- [ ] Remediation recommendations provided\n"
        doc += "- [ ] Client debriefing conducted\n\n"
        
        doc += "\n## Deliverables\n\n"
        doc += "1. Executive Summary\n"
        doc += "2. Technical Report\n"
        doc += "3. Risk Assessment\n"
        doc += "4. Remediation Recommendations\n"
        doc += "5. Evidence Documentation\n\n"
        
        return doc
    
    def generate_custom_methodology(self, name: str, phases: List[str]) -> str:
        """Generate custom methodology template"""
        doc = f"""# Custom Penetration Testing Methodology: {name}

## Methodology Overview

This document follows a custom penetration testing methodology.

---

## Testing Phases

"""
        for i, phase in enumerate(phases, 1):
            doc += f"### Phase {i}: {phase}\n\n"
            doc += "**Status**: ⏳ Not Started\n\n"
            doc += "**Objectives**:\n"
            doc += "- [ ] Define objectives for this phase\n\n"
            doc += "**Activities**:\n"
            doc += "- Activity 1\n"
            doc += "- Activity 2\n\n"
            doc += "**Deliverables**:\n"
            doc += "- Deliverable 1\n\n"
            doc += "---\n\n"
        
        return doc
    
    def list_methodologies(self) -> List[str]:
        """List available methodologies"""
        return list(self.methodologies.keys())
    
    def get_methodology_info(self, methodology: str) -> Dict:
        """Get information about a methodology"""
        if methodology.lower() in self.methodologies:
            return self.methodologies[methodology.lower()]
        return {}

def main():
    print("Methodology Templates Generator")
    print("=" * 50)
    
    templates = MethodologyTemplates()
    
    print("\nAvailable methodologies:")
    for meth_key in templates.list_methodologies():
        info = templates.get_methodology_info(meth_key)
        print(f"  - {meth_key.upper()}: {info['name']}")
    
    print("\nGenerating templates for all methodologies...\n")
    
    # Generate templates for all methodologies
    for meth_key in templates.list_methodologies():
        template = templates.generate_methodology_template(meth_key)
        filename = f"methodology_{meth_key}.md"
        
        with open(filename, 'w') as f:
            f.write(template)
        
        print(f"[+] Generated: {filename}")
    
    # Generate custom methodology example
    custom_phases = [
        'Reconnaissance',
        'Scanning',
        'Enumeration',
        'Vulnerability Assessment',
        'Exploitation',
        'Post-Exploitation',
        'Reporting'
    ]
    
    custom_template = templates.generate_custom_methodology("Custom 7-Phase", custom_phases)
    with open("methodology_custom.md", 'w') as f:
        f.write(custom_template)
    
    print(f"[+] Generated: methodology_custom.md")
    print("\n[+] All methodology templates generated successfully!")
    print("[!] Customize templates based on your specific testing needs")

if __name__ == '__main__':
    main()

