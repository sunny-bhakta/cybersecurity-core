#!/usr/bin/env node
/**
 * Scope Definition Template Generator
 * Generates penetration testing scope definition documents.
 */

const fs = require('fs');
const path = require('path');

class ScopeDefinitionTemplate {
    constructor() {
        this.template = {
            projectName: '',
            clientName: '',
            testDates: { start: '', end: '' },
            inScope: [],
            outOfScope: [],
            objectives: [],
            constraints: [],
            rulesOfEngagement: []
        };
    }

    addInScope(items) {
        this.template.inScope.push(...items);
    }

    addOutOfScope(items) {
        this.template.outOfScope.push(...items);
    }

    addObjectives(objectives) {
        this.template.objectives.push(...objectives);
    }

    addConstraints(constraints) {
        this.template.constraints.push(...constraints);
    }

    addRulesOfEngagement(rules) {
        this.template.rulesOfEngagement.push(...rules);
    }

    generateScopeDocument() {
        const date = new Date().toISOString().split('T')[0];
        
        let doc = `# Penetration Testing Scope Definition

## Project Information

**Project Name**: ${this.template.projectName}
**Client Name**: ${this.template.clientName}
**Test Period**: ${this.template.testDates.start} to ${this.template.testDates.end}
**Document Date**: ${date}

---

## Executive Summary

This document defines the scope, objectives, and constraints for the penetration testing engagement.

---

## Test Objectives

The primary objectives of this penetration test are:

`;

        this.template.objectives.forEach((obj, i) => {
            doc += `${i + 1}. ${obj}\n`;
        });

        doc += `\n---\n\n## In-Scope Assets\n\n`;
        doc += `The following assets, systems, and networks are **IN SCOPE** for this engagement:\n\n`;

        this.template.inScope.forEach((item, i) => {
            doc += `${i + 1}. ${item}\n`;
        });

        doc += `\n---\n\n## Out-of-Scope Assets\n\n`;
        doc += `The following assets, systems, and networks are **OUT OF SCOPE** for this engagement:\n\n`;

        this.template.outOfScope.forEach((item, i) => {
            doc += `${i + 1}. ${item}\n`;
        });

        doc += `\n---\n\n## Test Constraints\n\n`;
        doc += `The following constraints apply to this engagement:\n\n`;

        this.template.constraints.forEach((constraint, i) => {
            doc += `${i + 1}. ${constraint}\n`;
        });

        doc += `\n---\n\n## Rules of Engagement\n\n`;
        doc += `The following rules of engagement must be followed:\n\n`;

        this.template.rulesOfEngagement.forEach((rule, i) => {
            doc += `${i + 1}. ${rule}\n`;
        });

        doc += `\n---\n\n## Signatures\n\n`;
        doc += `**Client Representative**: _________________ Date: _________\n\n`;
        doc += `**Testing Team Lead**: _________________ Date: _________\n\n`;

        return doc;
    }

    setProjectInfo(projectName, clientName, startDate, endDate) {
        this.template.projectName = projectName;
        this.template.clientName = clientName;
        this.template.testDates.start = startDate;
        this.template.testDates.end = endDate;
    }
}

// Main execution
function main() {
    console.log('Scope Definition Template Generator');
    console.log('='.repeat(50));

    const scope = new ScopeDefinitionTemplate();

    // Set project information
    scope.setProjectInfo(
        'Example Corp Security Assessment',
        'Example Corporation',
        '2024-01-15',
        '2024-01-20'
    );

    // Add objectives
    scope.addObjectives([
        'Identify security vulnerabilities in web applications',
        'Test network security controls',
        'Assess authentication and authorization mechanisms',
        'Evaluate data protection measures'
    ]);

    // Add in-scope items
    scope.addInScope([
        'Web application: https://app.example.com',
        'API endpoints: https://api.example.com',
        'Network range: 192.168.1.0/24',
        'Mobile application: ExampleApp v2.0'
    ]);

    // Add out-of-scope items
    scope.addOutOfScope([
        'Production database (read-only access only)',
        'Third-party services',
        'Social engineering attacks',
        'Physical security testing',
        'Denial of Service (DoS) attacks'
    ]);

    // Add constraints
    scope.addConstraints([
        'Testing hours: 09:00 - 17:00 EST only',
        'No testing during maintenance windows',
        'No data modification or deletion',
        'Immediate notification required for critical findings'
    ]);

    // Add rules of engagement
    scope.addRulesOfEngagement([
        'Obtain explicit permission before testing',
        'Document all testing activities',
        'Maintain confidentiality of findings',
        'Follow responsible disclosure practices',
        'Comply with applicable laws and regulations'
    ]);

    // Generate document
    const document = scope.generateScopeDocument();

    // Save to file
    const filename = 'scope_definition.md';
    fs.writeFileSync(filename, document, 'utf8');

    console.log(`[+] Scope definition document generated`);
    console.log(`[+] Saved to: ${filename}`);
    console.log('\n[!] Review and customize the document before use');
}

if (require.main === module) {
    main();
}

module.exports = ScopeDefinitionTemplate;

