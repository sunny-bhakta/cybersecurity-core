#!/usr/bin/env node
/**
 * Methodology Templates Generator
 * Generates templates for various penetration testing methodologies.
 */

const fs = require('fs');

class MethodologyTemplates {
    constructor() {
        this.methodologies = {
            owasp: {
                name: 'OWASP Testing Guide',
                phases: [
                    'Information Gathering',
                    'Configuration and Deployment Management Testing',
                    'Identity Management Testing',
                    'Authentication Testing',
                    'Authorization Testing',
                    'Session Management Testing',
                    'Input Validation Testing',
                    'Error Handling Testing',
                    'Cryptography Testing',
                    'Business Logic Testing',
                    'Client-Side Testing'
                ]
            },
            ptes: {
                name: 'PTES (Penetration Testing Execution Standard)',
                phases: [
                    'Pre-engagement Interactions',
                    'Intelligence Gathering',
                    'Threat Modeling',
                    'Vulnerability Analysis',
                    'Exploitation',
                    'Post Exploitation',
                    'Reporting'
                ]
            },
            nist: {
                name: 'NIST SP 800-115',
                phases: [
                    'Planning',
                    'Discovery',
                    'Attack',
                    'Reporting'
                ]
            },
            osstmm: {
                name: 'OSSTMM (Open Source Security Testing Methodology Manual)',
                phases: [
                    'Regulatory',
                    'Posture Review',
                    'Logistics',
                    'Active Detection Verification',
                    'Visibility Audit',
                    'Access Verification',
                    'Trust Verification',
                    'Service Verification',
                    'Control Verification',
                    'Process Verification',
                    'Configuration Verification',
                    'Integrity Verification',
                    'Alarm Verification',
                    'Segmentation Verification'
                ]
            }
        };
    }

    generateMethodologyTemplate(methodology) {
        const methKey = methodology.toLowerCase();
        if (!this.methodologies[methKey]) {
            return `Unknown methodology: ${methodology}`;
        }

        const meth = this.methodologies[methKey];

        let doc = `# ${meth.name} Penetration Testing Template

## Methodology Overview

This document follows the **${meth.name}** methodology for penetration testing.

---

## Testing Phases

`;

        meth.phases.forEach((phase, i) => {
            doc += `### Phase ${i + 1}: ${phase}\n\n`;
            doc += `**Status**: ⏳ Not Started\n\n`;
            doc += `**Objectives**:\n`;
            doc += `- [ ] Objective 1\n`;
            doc += `- [ ] Objective 2\n`;
            doc += `- [ ] Objective 3\n\n`;
            doc += `**Tools Used**:\n`;
            doc += `- Tool 1\n`;
            doc += `- Tool 2\n\n`;
            doc += `**Findings**:\n`;
            doc += `- Finding 1\n`;
            doc += `- Finding 2\n\n`;
            doc += `**Notes**:\n`;
            doc += `Add notes here...\n\n`;
            doc += `---\n\n`;
        });

        doc += `\n## Testing Checklist\n\n`;
        doc += `### Pre-Engagement\n\n`;
        doc += `- [ ] Scope defined and approved\n`;
        doc += `- [ ] Rules of engagement established\n`;
        doc += `- [ ] Legal authorization obtained\n`;
        doc += `- [ ] Communication channels established\n`;
        doc += `- [ ] Testing environment prepared\n\n`;

        doc += `### During Testing\n\n`;
        doc += `- [ ] All phases documented\n`;
        doc += `- [ ] Evidence collected for all findings\n`;
        doc += `- [ ] Critical findings reported immediately\n`;
        doc += `- [ ] Testing activities logged\n\n`;

        doc += `### Post-Engagement\n\n`;
        doc += `- [ ] Final report prepared\n`;
        doc += `- [ ] Findings validated\n`;
        doc += `- [ ] Remediation recommendations provided\n`;
        doc += `- [ ] Client debriefing conducted\n\n`;

        doc += `\n## Deliverables\n\n`;
        doc += `1. Executive Summary\n`;
        doc += `2. Technical Report\n`;
        doc += `3. Risk Assessment\n`;
        doc += `4. Remediation Recommendations\n`;
        doc += `5. Evidence Documentation\n\n`;

        return doc;
    }

    generateCustomMethodology(name, phases) {
        let doc = `# Custom Penetration Testing Methodology: ${name}

## Methodology Overview

This document follows a custom penetration testing methodology.

---

## Testing Phases

`;

        phases.forEach((phase, i) => {
            doc += `### Phase ${i + 1}: ${phase}\n\n`;
            doc += `**Status**: ⏳ Not Started\n\n`;
            doc += `**Objectives**:\n`;
            doc += `- [ ] Define objectives for this phase\n\n`;
            doc += `**Activities**:\n`;
            doc += `- Activity 1\n`;
            doc += `- Activity 2\n\n`;
            doc += `**Deliverables**:\n`;
            doc += `- Deliverable 1\n\n`;
            doc += `---\n\n`;
        });

        return doc;
    }

    listMethodologies() {
        return Object.keys(this.methodologies);
    }

    getMethodologyInfo(methodology) {
        const methKey = methodology.toLowerCase();
        return this.methodologies[methKey] || {};
    }
}

// Main execution
function main() {
    console.log('Methodology Templates Generator');
    console.log('='.repeat(50));

    const templates = new MethodologyTemplates();

    console.log('\nAvailable methodologies:');
    templates.listMethodologies().forEach(methKey => {
        const info = templates.getMethodologyInfo(methKey);
        console.log(`  - ${methKey.toUpperCase()}: ${info.name}`);
    });

    console.log('\nGenerating templates for all methodologies...\n');

    // Generate templates for all methodologies
    templates.listMethodologies().forEach(methKey => {
        const template = templates.generateMethodologyTemplate(methKey);
        const filename = `methodology_${methKey}.md`;

        fs.writeFileSync(filename, template, 'utf8');
        console.log(`[+] Generated: ${filename}`);
    });

    // Generate custom methodology example
    const customPhases = [
        'Reconnaissance',
        'Scanning',
        'Enumeration',
        'Vulnerability Assessment',
        'Exploitation',
        'Post-Exploitation',
        'Reporting'
    ];

    const customTemplate = templates.generateCustomMethodology('Custom 7-Phase', customPhases);
    fs.writeFileSync('methodology_custom.md', customTemplate, 'utf8');

    console.log(`[+] Generated: methodology_custom.md`);
    console.log('\n[+] All methodology templates generated successfully!');
    console.log('[!] Customize templates based on your specific testing needs');
}

if (require.main === module) {
    main();
}

module.exports = MethodologyTemplates;

